<app-header></app-header>

<div class="services-container">
  <!-- Header Section -->
  <div class="services-header">
    <h1 class="services-title">Catálogo de Servicios</h1>
    <p class="services-description">
      Explora nuestros servicios notariales y elige el que necesitas
    </p>
  </div>

  <!-- Category Filter Tabs -->
  <div class="category-filters">
    @for (category of categories; track category.id) {
      <button
        pButton
        [label]="category.name"
        [class.active]="isCategoryActive(category.id)"
        (click)="filterByCategory(category.id)"
        class="filter-button"
      ></button>
    }
  </div>

  <!-- Loading State with Skeletons -->
  @if (isLoading()) {
    <div class="services-grid">
      @for (item of [1,2,3,4,5,6]; track item) {
        <p-card class="service-card">
          <div class="skeleton-content">
            <p-skeleton shape="circle" size="4rem" styleClass="mb-3"></p-skeleton>
            <p-skeleton width="80%" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="100%" height="60px" styleClass="mb-3"></p-skeleton>
            <p-skeleton width="60%" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="60%" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="60%" styleClass="mb-3"></p-skeleton>
            <p-skeleton width="50%" height="30px" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="100%" height="40px"></p-skeleton>
          </div>
        </p-card>
      }
    </div>
  }

  <!-- Error State -->
  @else if (error()) {
    <div class="error-state">
      <i class="pi pi-exclamation-triangle error-icon"></i>
      <h3 class="error-title">Error al cargar servicios</h3>
      <p class="error-message">{{ error() }}</p>
      <button
        pButton
        label="Reintentar"
        icon="pi pi-refresh"
        (click)="retryLoad()"
        class="retry-button"
      ></button>
    </div>
  }

  <!-- Services Grid -->
  @else if (filteredServices().length > 0) {
    <div class="services-grid">
      @for (service of filteredServices(); track service.id) {
        <p-card styleClass="service-card">
          <!-- Card Header: Icon (left) + Category Tag (right) -->
          <ng-template pTemplate="header">
            <div class="card-header">
              <div class="service-icon-wrapper">
                <i [class]="'pi ' + service.icon + ' service-icon'"></i>
              </div>

              @if (service.subcategory) {
                <p-tag
                  [value]="service.subcategory.toUpperCase()"
                  severity="success"
                  styleClass="category-tag"
                ></p-tag>
              }
            </div>
          </ng-template>

          <!-- Service Name -->
          <h3 class="service-name">{{ service.name }}</h3>

          <!-- Service Description (2-line clamp) -->
          <p class="service-description">{{ service.description }}</p>

          <!-- Price Range -->
          <div class="service-price">{{ service.estimated_price }}</div>

          <!-- Features List (up to 5 items) -->
          @if (service.features && service.features.length > 0) {
            <ul class="features-list">
              @for (feature of getDisplayFeatures(service.features, 5); track feature) {
                <li class="feature-item">
                  <i class="pi pi-check feature-check"></i>
                  <span>{{ feature }}</span>
                </li>
              }
            </ul>
          }

          <!-- Action Button -->
          <ng-template pTemplate="footer">
            <button
              pButton
              label="Solicitar Servicio"
              (click)="navigateToRequest(service.id)"
              class="request-button"
            ></button>
          </ng-template>
        </p-card>
      }
    </div>
  }

  <!-- Empty State -->
  @else {
    <div class="empty-state">
      <i class="pi pi-inbox empty-icon"></i>
      <h3 class="empty-title">No hay servicios disponibles</h3>
      <p class="empty-message">
        No se encontraron servicios en la categoría seleccionada.
      </p>
      <button
        pButton
        label="Ver todos los servicios"
        icon="pi pi-th-large"
        (click)="filterByCategory('todas')"
        class="view-all-button"
      ></button>
    </div>
  }
</div>
